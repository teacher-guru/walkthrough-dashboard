<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partnership Instructional Walkthrough Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .timer-display {
            font-family: 'Courier New', monospace;
        }
        .interval-section {
            border-left: 4px solid #3b82f6;
        }
        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-8">
        <div class="container mx-auto px-6">
            <h1 class="text-3xl font-bold text-center mb-2">Partnership Instructional Walkthrough</h1>
            <p class="text-center text-blue-100">Research-Based Classroom Observation Dashboard</p>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8 max-w-6xl">
        <!-- Basic Information Form -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Observation Information</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Observer Name *</label>
                        <input type="text" id="observer-name" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Enter observer name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Teacher Name *</label>
                        <input type="text" id="teacher-name" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Enter teacher name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date *</label>
                        <input type="date" id="observation-date" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                        <input type="time" id="observation-time"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                        <select id="subject" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select subject</option>
                            <option value="English Language Arts">English Language Arts</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Science">Science</option>
                            <option value="Social Studies">Social Studies</option>
                            <option value="Special Education">Special Education</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Grade Level</label>
                        <select id="grade-level" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select grade</option>
                            <option value="6th Grade">6th Grade</option>
                            <option value="7th Grade">7th Grade</option>
                            <option value="Mixed">Mixed Grades</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Class Size</label>
                        <input type="number" id="class-size" min="1" max="50"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Number of students present">
                    </div>
                </div>
            </div>
        </div>

        <!-- Interval Controls -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Observation Intervals</h2>
            <p class="text-gray-600 mb-6">Click each button to start a 5-minute observation interval. Complete intervals in order.</p>
            
            <div class="flex flex-wrap gap-4">
                <button onclick="addInterval(1)" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                    üìù Add Interval 1 (0-5 min)
                </button>
                
                <button onclick="addInterval(2)" 
                        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                    üìù Add Interval 2 (5-10 min)
                </button>
                
                <button onclick="addInterval(3)" 
                        class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                    üìù Add Interval 3 (10-15 min)
                </button>
            </div>
        </div>

        <!-- Intervals Container -->
        <div id="intervals-container" class="space-y-6 mb-8">
            <!-- Interval sections will be dynamically added here -->
        </div>

        <!-- Action Buttons -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Actions</h2>
            
            <div class="flex flex-wrap gap-4">
                <button onclick="calculateResults()" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                    üìä Calculate Results
                </button>
                
                <button onclick="generateReport()" 
                        class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                    üìÑ Generate PDF Report
                </button>
                
                <button onclick="exportData()" 
                        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                    üíæ Export CSV Data
                </button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="results-container" class="mb-8">
            <!-- Results will be displayed here -->
        </div>

        <!-- Research Information -->
        <div class="bg-blue-50 p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-bold text-blue-800 mb-4">üìö Research Foundation</h3>
            <div class="grid md:grid-cols-2 gap-6 text-sm text-blue-700">
                <div>
                    <h4 class="font-semibold mb-2">Calculation Methods:</h4>
                    <ul class="space-y-1">
                        <li>‚Ä¢ <strong>Student Engagement:</strong> Engaged students √∑ Class size √ó 100</li>
                        <li>‚Ä¢ <strong>Higher Order Thinking:</strong> Questions √∑ 3 expected √ó 100</li>
                        <li>‚Ä¢ <strong>Prompting & Follow-up:</strong> Prompts √∑ 5 expected √ó 100</li>
                        <li>‚Ä¢ <strong>Checks for Understanding:</strong> Checks √∑ 4 expected √ó 100</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-2">Performance Levels:</h4>
                    <ul class="space-y-1">
                        <li>‚Ä¢ <strong>80%+:</strong> Exceeds expectations</li>
                        <li>‚Ä¢ <strong>50-79%:</strong> Meets expectations</li>
                        <li>‚Ä¢ <strong>Below 50%:</strong> Growth opportunity</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let observationData = {};
        let currentTimer = null;
        let timeRemaining = 300; // 5 minutes in seconds
        let activeInterval = null;

        function addInterval(intervalNum) {
            const container = document.getElementById('intervals-container');
            
            // Check if interval already exists
            if (document.getElementById(`interval-${intervalNum}`)) {
                return;
            }
            
            const intervalDiv = document.createElement('div');
            intervalDiv.id = `interval-${intervalNum}`;
            intervalDiv.className = 'interval-section bg-white p-6 rounded-lg shadow-md mb-6';
            
            intervalDiv.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-blue-600">Interval ${intervalNum} (Minutes ${(intervalNum-1)*5}-${intervalNum*5})</h3>
                    <div class="timer-display text-2xl font-bold text-green-600" id="timer-${intervalNum}">5:00</div>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Student Engagement</label>
                            <input type="number" id="engagement-${intervalNum}" min="0" max="50" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Count of engaged students">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Higher Order Thinking Questions</label>
                            <input type="number" id="hot-${intervalNum}" min="0" max="20" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Count of questions">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Prompting & Follow-up</label>
                            <input type="number" id="prompting-${intervalNum}" min="0" max="20" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Count of prompts">
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Standards Alignment</label>
                            <select id="standards-${intervalNum}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select alignment</option>
                                <option value="evident">Evident</option>
                                <option value="not-evident">Not Evident</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Checks for Understanding</label>
                            <input type="number" id="checks-${intervalNum}" min="0" max="20" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Count of checks">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Release to Independence</label>
                            <select id="release-${intervalNum}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select level</option>
                                <option value="evident">Evident</option>
                                <option value="not-evident">Not Evident</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Students Responding to Text</label>
                            <select id="text-response-${intervalNum}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select response</option>
                                <option value="evident">Evident</option>
                                <option value="not-evident">Not Evident</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Attention to LPS Students</label>
                            <select id="lps-${intervalNum}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select attention</option>
                                <option value="evident">Evident</option>
                                <option value="not-evident">Not Evident</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Co-teaching Support</label>
                            <select id="coteaching-${intervalNum}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select support</option>
                                <option value="evident">Evident</option>
                                <option value="not-evident">Not Evident</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Observation Notes</label>
                    <textarea id="notes-${intervalNum}" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="Record specific observations, examples, and context..."></textarea>
                </div>
            `;
            
            container.appendChild(intervalDiv);
            
            // Start timer for this interval
            startTimer(intervalNum);
            
            // Scroll to the new interval
            intervalDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function startTimer(intervalNum) {
            // Stop any existing timer
            if (currentTimer) {
                clearInterval(currentTimer);
            }
            
            activeInterval = intervalNum;
            timeRemaining = 300; // Reset to 5 minutes
            
            const timerDisplay = document.getElementById(`timer-${intervalNum}`);
            if (!timerDisplay) return;
            
            currentTimer = setInterval(() => {
                timeRemaining--;
                
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                timerDisplay.textContent = display;
                
                // Change color as time runs out
                if (timeRemaining <= 60) {
                    timerDisplay.className = 'timer-display text-2xl font-bold text-red-600';
                } else if (timeRemaining <= 120) {
                    timerDisplay.className = 'timer-display text-2xl font-bold text-yellow-600';
                } else {
                    timerDisplay.className = 'timer-display text-2xl font-bold text-green-600';
                }
                
                // Timer finished
                if (timeRemaining <= 0) {
                    clearInterval(currentTimer);
                    timerDisplay.textContent = 'DONE';
                    timerDisplay.className = 'timer-display text-2xl font-bold text-blue-600';
                    
                    // Optional: Play sound or show notification
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification(`Interval ${intervalNum} Complete`, {
                            body: '5 minutes have elapsed for this observation interval.',
                            icon: '‚è∞'
                        });
                    }
                }
            }, 1000);
        }

        function calculateResults() {
            const classSize = parseInt(document.getElementById('class-size').value) || 1;
            const results = {};
            
            // Collect data from all intervals
            for (let i = 1; i <= 3; i++) {
                const intervalElement = document.getElementById(`interval-${i}`);
                if (!intervalElement) continue;
                
                const engagement = parseInt(document.getElementById(`engagement-${i}`)?.value) || 0;
                const hot = parseInt(document.getElementById(`hot-${i}`)?.value) || 0;
                const prompting = parseInt(document.getElementById(`prompting-${i}`)?.value) || 0;
                const checks = parseInt(document.getElementById(`checks-${i}`)?.value) || 0;
                const standards = document.getElementById(`standards-${i}`)?.value || '';
                const release = document.getElementById(`release-${i}`)?.value || '';
                const textResponse = document.getElementById(`text-response-${i}`)?.value || '';
                const lps = document.getElementById(`lps-${i}`)?.value || '';
                const coteaching = document.getElementById(`coteaching-${i}`)?.value || '';
                
                results[`interval${i}`] = {
                    engagement,
                    hot,
                    prompting,
                    checks,
                    standards,
                    release,
                    textResponse,
                    lps,
                    coteaching
                };
            }
            
            // Calculate averages and percentages
            const totalIntervals = Object.keys(results).length;
            if (totalIntervals === 0) {
                alert('Please add at least one interval before calculating results.');
                return;
            }
            
            // Student Engagement (percentage of class engaged)
            const avgEngagement = Object.values(results).reduce((sum, interval) => sum + interval.engagement, 0) / totalIntervals;
            const engagementPercent = Math.round((avgEngagement / classSize) * 100);
            
            // Higher Order Thinking (expected: 3 per 5-minute interval)
            const avgHOT = Object.values(results).reduce((sum, interval) => sum + interval.hot, 0) / totalIntervals;
            const hotPercent = Math.round((avgHOT / 3) * 100);
            
            // Prompting & Follow-up (expected: 5 per 5-minute interval)
            const avgPrompting = Object.values(results).reduce((sum, interval) => sum + interval.prompting, 0) / totalIntervals;
            const promptingPercent = Math.round((avgPrompting / 5) * 100);
            
            // Checks for Understanding (expected: 4 per 5-minute interval)
            const avgChecks = Object.values(results).reduce((sum, interval) => sum + interval.checks, 0) / totalIntervals;
            const checksPercent = Math.round((avgChecks / 4) * 100);
            
            // Binary categories (evident/not evident)
            const standardsCount = Object.values(results).filter(interval => interval.standards === 'evident').length;
            const standardsPercent = Math.round((standardsCount / totalIntervals) * 100);
            
            const releaseCount = Object.values(results).filter(interval => interval.release === 'evident').length;
            const releasePercent = Math.round((releaseCount / totalIntervals) * 100);
            
            const textResponseCount = Object.values(results).filter(interval => interval.textResponse === 'evident').length;
            const textResponsePercent = Math.round((textResponseCount / totalIntervals) * 100);
            
            const lpsCount = Object.values(results).filter(interval => interval.lps === 'evident').length;
            const lpsPercent = Math.round((lpsCount / totalIntervals) * 100);
            
            const coteachingApplicable = Object.values(results).filter(interval => interval.coteaching !== 'na').length;
            const coteachingCount = Object.values(results).filter(interval => interval.coteaching === 'evident').length;
            const coteachingPercent = coteachingApplicable > 0 ? Math.round((coteachingCount / coteachingApplicable) * 100) : 0;
            
            // Display results
            displayResults({
                engagement: engagementPercent,
                hot: hotPercent,
                prompting: promptingPercent,
                checks: checksPercent,
                standards: standardsPercent,
                release: releasePercent,
                textResponse: textResponsePercent,
                lps: lpsPercent,
                coteaching: coteachingPercent
            });
        }

        function displayResults(percentages) {
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Observation Results</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600">${percentages.engagement}%</div>
                            <div class="text-sm text-gray-600">Student Engagement</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <div class="text-2xl font-bold text-purple-600">${percentages.hot}%</div>
                            <div class="text-sm text-gray-600">Higher Order Thinking</div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600">${percentages.prompting}%</div>
                            <div class="text-sm text-gray-600">Prompting & Follow-up</div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <div class="text-2xl font-bold text-yellow-600">${percentages.standards}%</div>
                            <div class="text-sm text-gray-600">Standards Alignment</div>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <div class="text-2xl font-bold text-red-600">${percentages.checks}%</div>
                            <div class="text-sm text-gray-600">Checks for Understanding</div>
                        </div>
                        <div class="text-center p-4 bg-cyan-50 rounded-lg">
                            <div class="text-2xl font-bold text-cyan-600">${percentages.release}%</div>
                            <div class="text-sm text-gray-600">Release to Independence</div>
                        </div>
                        <div class="text-center p-4 bg-pink-50 rounded-lg">
                            <div class="text-2xl font-bold text-pink-600">${percentages.textResponse}%</div>
                            <div class="text-sm text-gray-600">Responding to Text</div>
                        </div>
                        <div class="text-center p-4 bg-lime-50 rounded-lg">
                            <div class="text-2xl font-bold text-lime-600">${percentages.lps}%</div>
                            <div class="text-sm text-gray-600">LPS Student Support</div>
                        </div>
                        <div class="text-center p-4 bg-orange-50 rounded-lg">
                            <div class="text-2xl font-bold text-orange-600">${percentages.coteaching}%</div>
                            <div class="text-sm text-gray-600">Co-teaching Support</div>
                        </div>
                    </div>
                </div>
            `;
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function generateReport() {
            // Collect all form data
            const observerName = document.getElementById('observer-name').value;
            const teacherName = document.getElementById('teacher-name').value;
            const date = document.getElementById('observation-date').value;
            const time = document.getElementById('observation-time').value;
            const subject = document.getElementById('subject').value;
            const gradeLevel = document.getElementById('grade-level').value;
            const classSize = document.getElementById('class-size').value;
            
            if (!observerName || !teacherName || !date) {
                alert('Please fill in the required fields (Observer Name, Teacher Name, and Date)');
                return;
            }
            
            // Calculate results first
            calculateResults();
            
            // Generate PDF report (simplified version)
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                <head>
                    <title>Instructional Walkthrough Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
                        .results { margin-bottom: 30px; }
                        .metric { margin-bottom: 10px; padding: 10px; background: #f5f5f5; border-radius: 5px; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Partnership Instructional Walkthrough</h1>
                        <h2>Observation Report</h2>
                    </div>
                    
                    <div class="info-grid">
                        <div>
                            <strong>Observer:</strong> ${observerName}<br>
                            <strong>Teacher:</strong> ${teacherName}<br>
                            <strong>Date:</strong> ${date}<br>
                        </div>
                        <div>
                            <strong>Time:</strong> ${time}<br>
                            <strong>Subject:</strong> ${subject}<br>
                            <strong>Grade Level:</strong> ${gradeLevel}<br>
                            <strong>Class Size:</strong> ${classSize}<br>
                        </div>
                    </div>
                    
                    <div class="results">
                        <h3>Observation Results</h3>
                        <p>Results calculated and ready for review.</p>
                    </div>
                    
                    <script>
                        window.print();
                    </script>
                <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98806dde74344672',t:'MTc1OTM2ODU3MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
                </html>
            `);
        }

        function exportData() {
            // Collect all data
            const data = {
                observer: document.getElementById('observer-name').value,
                teacher: document.getElementById('teacher-name').value,
                date: document.getElementById('observation-date').value,
                time: document.getElementById('observation-time').value,
                subject: document.getElementById('subject').value,
                gradeLevel: document.getElementById('grade-level').value,
                classSize: document.getElementById('class-size').value,
                intervals: {}
            };
            
            // Collect interval data
            for (let i = 1; i <= 3; i++) {
                const intervalElement = document.getElementById(`interval-${i}`);
                if (intervalElement) {
                    data.intervals[i] = {
                        engagement: document.getElementById(`engagement-${i}`)?.value || '',
                        hot: document.getElementById(`hot-${i}`)?.value || '',
                        prompting: document.getElementById(`prompting-${i}`)?.value || '',
                        checks: document.getElementById(`checks-${i}`)?.value || '',
                        standards: document.getElementById(`standards-${i}`)?.value || '',
                        release: document.getElementById(`release-${i}`)?.value || '',
                        textResponse: document.getElementById(`text-response-${i}`)?.value || '',
                        lps: document.getElementById(`lps-${i}`)?.value || '',
                        coteaching: document.getElementById(`coteaching-${i}`)?.value || '',
                        notes: document.getElementById(`notes-${i}`)?.value || ''
                    };
                }
            }
            
            // Create and download CSV
            const csv = convertToCSV(data);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `walkthrough_${data.teacher}_${data.date}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function convertToCSV(data) {
            const headers = ['Observer', 'Teacher', 'Date', 'Time', 'Subject', 'Grade Level', 'Class Size'];
            const values = [data.observer, data.teacher, data.date, data.time, data.subject, data.gradeLevel, data.classSize];
            
            let csv = headers.join(',') + '\n';
            csv += values.join(',') + '\n\n';
            
            // Add interval data
            csv += 'Interval,Engagement,HOT Questions,Prompting,Checks,Standards,Release,Text Response,LPS Support,Co-teaching,Notes\n';
            
            for (let i = 1; i <= 3; i++) {
                if (data.intervals[i]) {
                    const interval = data.intervals[i];
                    csv += `${i},${interval.engagement},${interval.hot},${interval.prompting},${interval.checks},${interval.standards},${interval.release},${interval.textResponse},${interval.lps},${interval.coteaching},"${interval.notes}"\n`;
                }
            }
            
            return csv;
        }

        // Request notification permission on page load
        document.addEventListener('DOMContentLoaded', function() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });
    </script>
</body>
</html>

